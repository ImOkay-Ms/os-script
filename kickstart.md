# 1. 프로젝트 개요
Kickstart는 리눅스 운영체제 설치를 자동화하는 데 사용되는 설정 파일 포맷입니다. 이를 사용하면 설치 시 GUI 없이 자동으로 시스템을 설치하고 구성할 수 있습니다. 
일반적으로는 main server를 하나로 두고 PXE Booting을 통해 네트워크 방식으로 OS를 설치할 때 Kickstart를 많이 사용합니다. 
   
이는 시스템 관리자의 입장에서 유용하지만, 엔지니어가 OS를 설치할 때는 PXE 부팅 방식을 사용하지 않는 경우가 많습니다. 대신 기존 방식대로 USB를 통해 설치하는 방법을 사용합니다. 
이 경우, grub.cfg 파일을 수정하여 커널을 불러오는 과정에서 Kickstart 파일을 지정하는 새로운 탭을 추가하고, 미리 작성해둔 Kickstart 설정 파일을 연결하여 사전에 정의된 설정들이 설치와 동시에 자동으로 적용될 수 있도록 합니다.

# 2. 주요 기능
리눅스 설치 자동화: Kickstart를 사용하여 리눅스를 설치할 때 네트워크, 사용자, 파티션, 시스템 설정 등을 자동으로 구성.
   
맞춤형 OS 이미지 생성: 기존의 리눅스 설치 이미지에 Kickstart 스크립트를 통합하여, 설치 과정에서 설정 파일을 자동으로 적용할 수 있도록 함.
대규모 서버 관리: 여러 대의 서버에 동일한 설치 과정을 적용할 수 있어 대규모 서버 관리 및 배포에 유리.

# 3. 기술 스택
Kickstart: 리눅스 설치를 자동화하는데 필요한 설정 파일 작성.
   
Bash Scripting: Kickstart 파일 내에서 특정 조건에 따라 추가 설정을 위한 Bash 스크립트 작성.
   
Linux: Red Hat 기반 리눅스 (RHEL / CentOS)

# 4. 설치 및 실행 방법
1️⃣ Kickstart 파일 준비: 필요한 네트워크, 파티션, 사용자 설정 등을 포함한 Kickstart 파일을 작성합니다.
   
방법 1. https://docs.redhat.com/ko/documentation/red_hat_enterprise_linux/8/html/automatically_installing_rhel/creating-kickstart-files_rhel-installer#creating-a-kickstart-file-with-the-kickstart-configuration-tool_creating-kickstart-files   
상단의 링크를 통해 새로운 파일을 작성합니다. 단 redhat 계정과 라이센스가 필요합니다.
   
방법 2. 기존에 OS 가 설치된 서버의 Anaconda-ks.cfg 파일을 수정합니다 이 파일이 kickstart 파일의 기본 양식이며 간단하고 편리하기 때문에 이 방식을 많이 사용합니다.
아래 code가 test 용으로 수정해둔 cfg 파일입니다.
```
# Generated by Anaconda 34.25.4.9
# Generated by pykickstart v3.32
#version=RHEL9
# Use graphical install
graphical
repo --name="AppStream" --baseurl=file:///run/install/sources/mount-0000-hdd-device/AppStream

%addon com_redhat_kdump --enable --reserve-mb='auto'

%end

# Keyboard layouts
keyboard --xlayouts='us'
 
# System language
lang en_US.UTF-8   //원하는 언어 선택

# Use hard drive installation media
harddrive --dir= --partition=LABEL=RHEL-9-4-0-

%packages    //설치하고자 하는 pakage 선택, 여기서는 gui, performance, system-tools 만 선택했습니다.
@^graphical-server-environment
@performance
@system-tools
%end

%post //이곳에는 설치 후 실행 될 script 를 넣으시면 됩니다. 예시로 repo 파일을 자동으로 작성하는 script를 넣어 두었습니다.
cat <<EOF | sudo tee /etc/yum.repos.d/local.repo
[local-BaseOS]
name=Local BaseOS
baseurl=file:///localrepo/BaseOS
enabled=1
gpgcheck=0

[local-AppStream]
name=Local AppStream
baseurl=file:///localrepo/AppStream
enabled=1
gpgcheck=0
EOF
 
%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.6.0
ignoredisk --only-use=sda,sdb
 
# System bootloader configuration
bootloader --append="crashkernel=1G-4G:192M,4G-64G:256M,64G-:512M" --location=mbr --boot-drive=sda
 
# Partition clearing information
clearpart --none --initlabel
 
# Disk partitioning information //기존에 설정된 anaconda.cfg의 내용, partname, filesystem, size, ondisk, vg, lv를 미리 적용시켜 줄 수 있습니다. 만약 비워둔다면 설치중에 파티션 설정은 수동으로 해주어야 합니다.
part /boot/efi --fstype="efi" --ondisk=sda --size=600 --fsoptions="umask=0077,shortname=winnt"
part pv.589 --fstype="lvmpv" --ondisk=sdb --size=1143453
part /boot --fstype="xfs" --ondisk=sda --size=1024
part pv.240 --fstype="lvmpv" --ondisk=sda --size=569624
volgroup datavg --pesize=4096 pv.589
volgroup rootvg --pesize=4096 pv.240
logvol / --fstype="xfs" --size=536852 --name=lvroot --vgname=rootvg
logvol swap --fstype="swap" --size=32768 --name=lvswap --vgname=rootvg
logvol /data --fstype="xfs" --size=1143452 --name=data --vgname=datavg

# System timezone  //시간대 설정
timezone Asia/Seoul --utc

# Root password //root,admin 계정을 생성하고 비밀번호를 root123 으로 설정했습니다. 설치 후 변경 해주어야 합니다.
rootpw --iscrypted --allow-ssh $6$Tv8JQspS3zN5UNAP$5dXSPpNUMpQf6edjIKclpj2h67Ao.5sgz0TNg8EmWr1JEJtBsT5S.jE4HzrrUtBlXbZESlcrq2jK6TWJpM/oW.
user --name=admin --password=$6$3lKIrP7S5P4SxsVc$xxYfpe/VN4tkYQzkGOjSagFUDLFB4I9sjkQZ62VfkMmnkVMEsW8zOGhSUl4k9HrfME1nE6CEUfCOx4auZkz/Z0 --iscrypted --gecos="admin"
```

   
2️⃣ 설치 미디어에 Kickstart 포함: 작성한 Kickstart 파일을 설치 미디어에 포함시켜, 설치 시 자동으로 실행되도록 합니다.   
이를 위해 grub.cfg 파일을 수정해야 합니다
```
set default="1"

function load_video {
  insmod efi_gop
  insmod efi_uga
  insmod video_bochs
  insmod video_cirrus
  insmod all_video
}

load_video
set gfxpayload=keep
insmod gzio
insmod part_gpt
insmod ext2

set timeout=60
### END /etc/grub.d/00_header ###

search --no-floppy --set=root -l 'RHEL-9-4-0-'

### BEGIN /etc/grub.d/10_linux ###
menuentry 'Install Red Hat Enterprise Linux 9.4' --class fedora --class gnu-linux --class gnu --class os {
    linuxefi /images/pxeboot/vmlinuz inst.repo=hd:LABEL=RHEL-9-4-0- quiet
    initrdefi /images/pxeboot/initrd.img
}
menuentry 'Test this media & install Red Hat Enterprise Linux 9.4' --class fedora --class gnu-linux --class gnu --class os {
    linuxefi /images/pxeboot/vmlinuz inst.repo=hd:LABEL=RHEL-9-4-0- rd.live.check quiet
    initrdefi /images/pxeboot/initrd.img
}

//이 부분만 추가!
menuentry 'Kick Start Install' --class fedora --class gnu-linux --class gnu --class os {
    linuxefi /images/pxeboot/vmlinuz inst.repo=hd:LABEL=RHEL-9-4-0- rd.live.check inst.ks=hd:LABEL=RHEL-9-4-0-:/ks.cfg
    initrdefi /images/pxeboot/initrd.img
}

submenu 'Troubleshooting -->' {
    menuentry 'Install Red Hat Enterprise Linux 9.4 in text mode' --class fedora --class gnu-linux --class gnu --class os {
        linuxefi /images/pxeboot/vmlinuz inst.repo=hd:LABEL=RHEL-9-4-0- inst.text quiet
        initrdefi /images/pxeboot/initrd.img
    }
    menuentry 'Rescue a Red Hat Enterprise Linux system' --class fedora --class gnu-linux --class gnu --class os {
        linuxefi /images/pxeboot/vmlinuz inst.repo=hd:LABEL=RHEL-9-4-0- inst.rescue quiet
        initrdefi /images/pxeboot/initrd.img
    }
}
```


OS 설치: Kickstart 파일이 포함된 설치 이미지를 사용하여 리눅스를 설치합니다. 설치 과정은 자동으로 진행되며, 설치 후 설정이 완료됩니다.

설치 후 스크립트 실행: Kickstart 파일을 사용하여 OS 설치 후 특정 스크립트를 실행하여 추가 설정을 자동으로 적용할 수 있습니다.

# 5. 발전 가능성 및 향후 개선점
다양한 설정 자동화: 현재는 네트워크 설정, 사용자 추가, 패키지 설치에 초점을 맞추었지만, 이후에는 시스템 튜닝 및 보안 설정 등도 Kickstart에 포함시켜 더욱 자동화된 설치 환경을 만들 수 있습니다.   
다양한 리눅스 배포판 지원: RHEL과 CentOS 외에도 다양한 리눅스 배포판에 대한 지원을 추가하여 더욱 범용적인 설치 스크립트를 개발할 수 있습니다.   
설치 오류 핸들링 강화: 설치 중 오류가 발생할 경우에 대한 처리 로직을 추가하여 더욱 안정적인 설치 프로세스를 구현할 수 있습니다.   

# 6. 참고자료 및 출처
Red Hat 공식 Kickstart 문서 : https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/7/html/installation_guide/sect-kickstart-howto
Kickstart 설치 youtube : https://www.youtube.com/watch?v=qH3nqL-pVTQ
